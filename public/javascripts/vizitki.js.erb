var show_option_box = false;

$( document ).ready(function() {
resize_monitor();
clear_cash();

$("#material").click(function(){
	var xy = $(this).position();
	$("#material-options").css({"left": xy.left, "top": xy.top+29});
	$("#material-options").toggle();
	$("#help_invisieble_box").css({"display": "block"});
});

$("#select-color").click(function(){
	var xy = $(this).position();
	$("#select-color-options").css({"left": xy.left, "top": xy.top+29});
	$("#select-color-options").toggle();
	$("#help_invisieble_box").css({"display": "block"});
});
$( "#select-tirazh" ).click(function() {
	$( this ).val('');
});
$( "#select-tirazh" ).focusout(function() {
	if($( this ).val().match(/\D/) || $( this ).val() == ''){
		$( this ).val('Тираж');
	}
	else if($( this ).val()%100){
		if ($( this ).val() < 100) {
			$( this ).val(100);
		}
		else{
			tmpVal = Math.round($( this ).val()/100)*100;
			$( this ).val(tmpVal);
		}	
	}
	else if($( this ).val() == 0){
		$( this ).val(100);
	}
});

$(".selectoption_material").click(function(){
	var material = $('> input', this).val();
	var text = $(this).text()
	
	$("#material span").html(text);
	$("#material").children("input").val(material);
	
	$("#material-options").toggle();
	$("#help_invisieble_box").css({"display": "none"});
	//alert($(this).text());
	//alert($("#material").children("input").value);

});

$(".selectoption_color").click(function(){
	var color = $('> input', this).val();
	var text = $(this).text()
	
	$("#select-color span").html(text);
	$("#select-color").children("input").val(color);
	
	$("#select-color-options").toggle();
	$("#help_invisieble_box").css({"display": "none"});
});


$("#help_invisieble_box").click(function(){
	$(this).css({"display": "none"});
	$(".options-list").css({"display": "none"});
});


$(".radiobtn").click(function(){
	if ($(this).hasClass('selected')) {
		$(this).removeClass('selected');
		$(this).children("input").val(0);
		tisnenieOrVyrubkaChecked($(this).children("input").attr('name'), 0);
		//alert($(this).children("input").attr('name')+' unchecked');
	}
	else{
		$(this).addClass( "selected" );
		$(this).children("input").val(1);
		tisnenieOrVyrubkaChecked($(this).children("input").attr('name'), 1);
		//alert($(this).children("input").attr('name')+' checked');
	};
});


$("#calculate").click(function(){
	//here will be validation and collecting all values
	paper = $("[name='material']").val();
	tirazh = $("#select-tirazh").val();
	color = $("[name='color']").val();
	klishe_blint = $("[name='klishe_blint']").val();
	klishe_folga = $("[name='klishe_folga']").val();
	klishe_kongrev = $("[name='klishe_kongrev']").val();
	vyrubka = $("[name='vyrubka']").val();


	dp = new Array();
	dp[0] = $("[name='dp1']").val();
	dp[1] = $("[name='dp2']").val();
	dp[2] = $("[name='dp3']").val();
	dp[3] = $("[name='dp4']").val();
	dp[4] = $("[name='dp5']").val();
	dp[5] = $("[name='dp6']").val();
	dp[6] = $("[name='dp7']").val();
	dp[7] = $("[name='dp8']").val();
	dp[8] = $("[name='dp9']").val();
	
	if(paper == '' || color == '' || tirazh == '' || tirazh == 'Тираж'){
		$("#alert").show(0);
		$("#alert").text('Не хватает параметров!');
	}
	else{
		$("#alert").hide(0);

		$.ajax({
			url: '/index/result',
			type: 'POST',
			data: 'paper='+paper+'&color='+encodeURIComponent(color)+'&tirazh='+tirazh+'&dp='+dp+'&klishe_blint='+klishe_blint+'&klishe_folga='+klishe_folga+'&klishe_kongrev='+klishe_kongrev+'&vyrubka='+vyrubka,
			//dataType: "json",
			success: function(tmp){
				$('#result').text(tmp);
			}
		});
	}	
}); //end of calculate click

});//end of document ready function




$( window ).resize(function() {
resize_monitor();
});



function resize_monitor() {
	var windowHSize = document.body.clientWidth;
	var windowVSize = document.body.clientHeight;

	var wrapperHSize = (windowHSize-20)/3;
	var wrapperVSize = (windowVSize-20)/3;

	$("#text").text(windowHSize+" : "+windowVSize+" : "+wrapperHSize);
	$(".wrapper").css({"width": wrapperHSize, "height": wrapperVSize});
	$(".wrapper_margin").css({"height": wrapperVSize});

	if (windowHSize > 1546) {
		$("#right-top-hidden").css({"display": "block"});
		$("#contentcolumn").css({"width": 1260});
	}
	else{
		$("#right-top-hidden").css({"display": "none"});
		$("#contentcolumn").css({"width": 940});
	}
	
}
function clear_cash() {
	$("[name='material']").val('');
	$("[name='color']").val('');
	$("#select-tirazh").val('Тираж');
	$("[name='dp1']").val(0);
	$("[name='dp2']").val(0);
	$("[name='dp3']").val(0);
	$("[name='dp4']").val(0);
	$("[name='dp5']").val(0);
	$("[name='dp6']").val(0);
	$("[name='dp7']").val(0);
	$("[name='dp8']").val(0);
	$("[name='dp9']").val(0);
	$("[name='klishe_blint']").val(0);
	$("[name='klishe_folga']").val(0);
	$("[name='klishe_kongrev']").val(0);
	$("[name='vyrubka']").val(0);
}
function tisnenieOrVyrubkaChecked(dp, checked) {						//$(this).children("input").attr('name')
	if (dp == 'dp1') {
		if(checked){
			$("#notice1").show(0);
		}
		else{
			$("#notice1").hide(0);
			if ($("input[name='klishe_blint']").parent().hasClass('selected')) {
				$("input[name='klishe_blint']").parent().removeClass('selected');
				$("input[name='klishe_blint']").val(0);
			}
		}
	}
		if (dp == 'dp2') {
		if(checked){
			$("#notice2").show(0);
		}
		else{
			$("#notice2").hide(0);
			if ($("input[name='klishe_folga']").parent().hasClass('selected')) {
				$("input[name='klishe_folga']").parent().removeClass('selected');
				$("input[name='klishe_folga']").val(0);
			}
		}
	}
	if (dp == 'dp3') {
		if(checked){
			$("#notice3").show(0);
		}
		else{
			$("#notice3").hide(0);
			if ($("input[name='klishe_kongrev']").parent().hasClass('selected')) {
				$("input[name='klishe_kongrev']").parent().removeClass('selected');
				$("input[name='klishe_kongrev']").val(0);
			}
		}
	}
	if (dp == 'dp9') {
		if(checked){
			$("#notice4").show(0);
		}
		else{
			$("#notice4").hide(0);
			if ($("input[name='vyrubka']").parent().hasClass('selected')) {
				$("input[name='vyrubka']").parent().removeClass('selected');
				$("input[name='vyrubka']").val(0);
			}
		}
	}
}
